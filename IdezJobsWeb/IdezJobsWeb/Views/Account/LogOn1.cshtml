@model IdezJobsWeb.Models.UserCollege
@{
	ViewBag.Title = "IdezJobs";
}
<h2>
	Seja Bem Vindo Ao IdezJobs</h2>
</br>
<h3>
	Faça Login Usando o Linkedin
</h3>
<html>
<head>
	<title>Perfil do Usuário</title>
	<script type="text/javascript" src="http://platform.linkedin.com/in.js">
		api_key: ixvlxp7r4eqh
		authorize: true
	</script>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link media="all" type="text/css" href="http://developer.linkedinlabs.com/tutorials/css/jqueryui.css"
		rel="stylesheet" />
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.5b1.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.7/jquery-ui.min.js"></script>
	<script type="text/javascript">
		function onLinkedInLoad() {
			IN.Event.on(IN, "auth", function () { onLinkedInLogin(); });
			IN.Event.on(IN, "logout", function () { onLinkedInLogout(); });
		}

		function onLinkedInLogout() {
			setLoginBadge(false);
		}

		function profile() {

			IN.API.Profile("me")
			.field(["id", "firstName", "lastName", "pictureUrl", "publicUrl", "headline", "industry", "interests"])
			.result(function (result) {
				this.publicProfileUrl = result.values[0].lastName
				this.id = result.values[0].id;
				this.firstName = result.values[0].firstName;
				this.pictureUrl = result.values[0].pictureUrl;
				this.publicUrl = result.values[0].publicUrl;
				this.headline = result.values[0].headline;
				this.industry = result.values[0].industry;
				this.interests = result.values[0].interests;

			});


		}

		function onLinkedInLogin() {
			// we pass field selectors as a single parameter (array of strings)
			IN.API.Profile("me")
			.fields(["id", "firstName", "lastName", "pictureUrl", "publicProfileUrl", "headline", "industry", "interests", "emailAddress", "honors"])
			.result(function (result) {
				console.log(result);
				//setLoginBadge(result.values[0]);
				var dados = {
					id: result.values[0].id

				};
				alert("Primeira chamada:");
				$.ajax({
					type: "POST",
					url: "http://localhost:1677/Account/saveUser/",
					data: result.values[0],
					dataType: 'json',
					success: function (result) {
						//alert(json.stringify(dados));
						if (result.codigo == 1) {
							console.log(result.msg);
						}
						else {
							console.log("Ocorreu algum erro!");
							console.log(result);
						}
					}
				});

			});
		}

		function setLoginBadge(profile) {
			var cont = 0;

			if (!profile) {
				profHTML = "<p>You are not logged in</p>";
			}
			else {
				var pictureUrl = profile.pictureUrl || "http://static02.linkedin.com/scds/common/u/img/icon/icon_no_photo_80x80.png";
				profHTML = "<p><a href=\"" + profile.publicProfileUrl + "\">";
				profHTML = profHTML + "<img align=\"baseline\" src=\"" + pictureUrl + "\"></a>";
				profHTML = profHTML + "&nbsp; Welcome <a href=\"" + profile.publicProfileUrl + "\">";
				profHTML = profHTML + profile.firstName + " " + profile.lastName + "</a>! <a href=\"#\" onclick=\"IN.User.logout(); return false;\"><img src='../../css/img/logout.png' width='20' height='20' title='Logout'/></a></p>";
				profHTML = profHTML + "Atualmente atua como: " + profile.headline;
				profHTML = profHTML + "<br />Industria: " + profile.industry;
				profHTML = profHTML + "<br />Id: " + profile.headline;
				profHTML = profHTML + "<br />Email: " + profile.emailAddress;
				profHTML = profHTML + "<br /> Interesse: " + profile.interests;


			}

			document.getElementById("loginbadge").innerHTML = profHTML;
		}


		function searchCandidates(parametros) {
			//realizo consulta no banco para retornar todos os ids registrados
		}

		function includeFilters(profile) {
			var parameters = {
				pictureUrl: pictureUrl,
				publicProfileUrl: profile.publicProfileUrl,
				lastName: profile.lastName,
				headline: profile.headline,
				industry: profile.industry
			}

			return parameters;
		}

		function saveUser(profile) {
			document.getElementById("iduser").value = profile.id;
			alert(document.getElementById("iduser").value);
		}
	</script>

	
</head>
<body class="yui3-skin-sam  yui-skin-sam">
</body>
</html>
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
@Html.ValidationSummary(true, "Login was unsuccessful. Please correct the errors and try again.")
@using (Html.BeginForm( ))
{
	<div>
		<fieldset>
			<legend>Por Favor Forneça Informações:</legend>
			<div class="editor-label">
				@Html.LabelFor(m => m.Name)
			</div>
			<div class="editor-field">
				@Html.TextBoxFor(m => m.Name)
				@Html.ValidationMessageFor(m => m.Name)
			</div>
			<div class="editor-label">
				@Html.LabelFor(m => m.Password)
			</div>
			<div class="editor-field">
				@Html.PasswordFor(m => m.Password)
				@Html.ValidationMessageFor(m => m.Password)
			</div>
			<div class="editor-label">
				@Html.CheckBoxFor(m => m.RememberMe)
				@Html.LabelFor(m => m.RememberMe)
			</div>
			<p>
				<input type="submit" value="Entrar" id="ButtonEntrar" />
			</p>
		</fieldset>
	</div>
}
